<div align="center"><a href="https://netopia-payments.com/"><img alt="Parsedown" src="https://suport.mobilpay.ro/np-logo-blue.svg" width="240" /></a></div>

# NETOPIA Payments
## NETOPIA Payments Composer

### Installation
Run the following command from root of your project 
* <code>composer require netopia/payment:1.0.0</code>
#### or 
* add the **"netopia/payment": "1.0.0"** to your **composer.json** file like the following example
    <code>

        "require": {
            ...
            "netopia/payment": "1.0.0",
            ...
        }
    </code>
    
    and then run the following command from your Terminal
    
    <code>composer install</code>
    
### Example        
<code>

    ...
    
    use Netopia\Payment\PaymentAddress;
    use Netopia\Payment\PaymentInvoice;
    use Netopia\Payment\Request\PaymentRequestCard;
    
    ...
    
    class ExampleController extends Controller
    {
        /**
         * all payment requests will be sent to the NETOPIA Payments server
         * SANDBOX : http://sandboxsecure.mobilpay.ro
         * LIVE : https://secure.mobilpay.ro
         */
        public $paymentUrl;
        /**
         * NETOPIA Payments is working only with Certificate. Each NETOPIA member has a certificate.
         * From your Admin panel you can download the Certificate.
         * is located in Admin -> Conturi de comerciant -> Detalii -> Setari securitate
         * the var $x509FilePath is path of your certificate in your platform
         * i.e: /home/certificates/public.cer
         */
        public $x509FilePath;
        /**
         * Billing Address
         */
        public $billingAddress;
        /**
         * Shipping Address
         */
        public $shippingAddress;
        
        ...
        
        public function index()
        {
            $this->paymentUrl   = 'http://sandboxsecure.mobilpay.ro';
            $this->x509FilePath = '/home/navid/Projects/laratry/certificates/sandbox.YN8Q-RH4J-39C1-FPAG-2P8A.public.cer';
            try {
                $paymentRequest = new PaymentRequestCard();
                $paymentRequest->signature  = 'XXXX-XXXX-XXXX-XXXX-XXXX';//signature - generated by mobilpay.ro for every merchant account
                $paymentRequest->orderId    = md5(uniqid(rand())); // order_id should be unique for a merchant account
                $paymentRequest->confirmUrl = 'https://example.test/card/success'; // is where mobilPay redirects the client once the payment process is finished and is MANDATORY
                $paymentRequest->returnUrl  = 'https://example.test/ipn';// is where mobilPay will send the payment result and is MANDATORY
    
                /*
                 * Invoices info
                 */
                $paymentRequest->invoice = new PaymentInvoice();
                $paymentRequest->invoice->currency  = 'RON';
                $paymentRequest->invoice->amount    = '20.00';
                $paymentRequest->invoice->tokenId   = null;
                $paymentRequest->invoice->details   = "Payment Via Composer library";
    
                /*
                 * Billing Info
                 */
                $this->billingAddress = new PaymentAddress();
                $this->billingAddress->type         = "person"; //should be "person" / "company"
                $this->billingAddress->firstName    = "Billing name";
                $this->billingAddress->lastName     = "Billing LastName";
                $this->billingAddress->address      = "Bulevardul Ion CreangÄƒ, Nr 00";
                $this->billingAddress->email        = "test@billing.com";
                $this->billingAddress->mobilePhone =  "0732123456";
                $paymentRequest->invoice->setBillingAddress($this->billingAddress);
    
                /*
                 * Shipping
                 */
                $this->shippingAddress = new PaymentAddress();
                $this->shippingAddress->type        = "person"; //should be "person" / "company"
                $this->shippingAddress->firstName   = "Shipping Name";
                $this->shippingAddress->lastName    = "Shipping LastName";
                $this->shippingAddress->address     = "Bulevardul Mihai Eminescu, Nr 00";
                $this->shippingAddress->email       = "test@shipping.com";
                $this->shippingAddress->mobilePhone = "0721234567";
                $paymentRequest->invoice->setShippingAddress($this->shippingAddress);
    
                /*
                 * encrypting
                 */
                $paymentRequest->encrypt($this->x509FilePath);
    
                /**
                 * send the following data to NETOPIA Payments server
                 * Method : POST
                 * URL : $paymentUrl
                 */
                $EnvKey = $paymentRequest->getEnvKey();
                $data   = $paymentRequest->getEncData();
            }catch (\Exception $e)
            {
                return "Oops, There is a problem!";
            }
        }
        ...
    }    
    
</code>

